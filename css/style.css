// layout.js — safe header/footer injection + dark mode + active link
(function() {
  function buildHeader() {
    return `
      <header>
        <div class="logo">
          <img src="assets/logo.png" alt="Pebb Logo" />
          <h1>Pebb</h1>
        </div>
        <nav>
          <a href="index.html">Home</a>
          <a href="shop.html">Shop</a>
          <a href="watch.html">Watch</a>
          <a href="news.html">News</a>
          <a href="about.html">About</a>
          <button id="theme-toggle" class="theme-btn" aria-label="Toggle theme">☀️</button>
        </nav>
      </header>
    `;
  }

  function buildFooter() {
    return `<footer><p>© 2025 Pebb</p></footer>`;
  }

  function setActiveNav() {
    try {
      const links = document.querySelectorAll("nav a");
      const current = window.location.pathname.split("/").pop() || "index.html";
      links.forEach(a => {
        const href = a.getAttribute("href");
        if (!href) return;
        if (href === current) a.classList.add("active");
        else a.classList.remove("active");
      });
    } catch (e) { /* ignore */ }
  }

  document.addEventListener("DOMContentLoaded", () => {
    // Only insert header/footer if placeholders exist
    const headerEl = document.querySelector("header");
    const footerEl = document.querySelector("footer");
    if (headerEl && headerEl.innerHTML.trim() === "") {
      headerEl.outerHTML = buildHeader();
    } else if (!headerEl) {
      // if no header placeholder found, insert at top of body
      document.body.insertAdjacentHTML("afterbegin", buildHeader());
    }

    if (footerEl && footerEl.innerHTML.trim() === "") {
      footerEl.outerHTML = buildFooter();
    } else if (!footerEl) {
      document.body.insertAdjacentHTML("beforeend", buildFooter());
    }

    // theme
    const saved = localStorage.getItem("theme");
    if (saved === "dark") document.body.classList.add("dark-mode");
    setActiveNav();

    // theme toggle listener
    document.addEventListener("click", (e) => {
      const t = e.target;
      if (t && t.id === "theme-toggle") {
        document.body.classList.toggle("dark-mode");
        const isDark = document.body.classList.contains("dark-mode");
        t.textContent = isDark ? "🌙" : "☀️";
        localStorage.setItem("theme", isDark ? "dark" : "light");
      }
    });

    // small fade-in
    document.body.classList.add("fade-in");
  });
})();
